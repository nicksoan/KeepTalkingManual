@page "/wires3"
@using KeepTalkingManual.Lib.Enums
@using KeepTalkingManual.Lib.Models
@using KeepTalkingManual.Lib.HelperFunctions
@using Components

@rendermode InteractiveServer

<div class="container">
    <div class="row">
        <div class="col-md-12 mb-12">
            <div class="card h-100">
                <div class="card-body">
                    @if (_wireModule != null)
                    {
                        if (_wireModule.Instructions.Any())
                        {
                            <KeepTalkingManual.Components.Components.InstructionsList Instructions="_wireModule.Instructions"/>
                        }
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <p>Select wires in the order shown, from top to bottom.</p>
        <div class="col-md-9 mb-9">
            <div class="card h-100">
                <input type="button"
                       value="Reset"
                       @onclick="() => ClearWireSelection()" />

                <label for="txtSerialNumber" class="form-text">SerialNumber</label>
                <input type="text" id="txtSerialNumber" class="form-text" @bind="serialNumber" @bind:event="oninput" @onkeyup="OnSerialNumberKeyup" placeholder="Enter Serial Number" />

                @foreach (var wire in Enum.GetValues<choices_WireColour>())
                {
                    <input type="button"
                           value="@wire.ToString()"
                           class="@GetStyle.GetCheckboxStyle(wire) button"
                           @onclick="() => UpdateWireList(wire)" />
                }
            </div>
        </div>
        <div class="col-md-3 mb-3">
           <KeepTalkingManual.Components.Components.SelectedWires SelectedWireList="selectedWires" />
        </div>
    </div>
</div>

@code {
    private WireModule _wireModule;
    private List<choices_WireColour> selectedWires = new List<choices_WireColour>();
    private choices_WireColour currentWireColour;
    private string serialNumber;

    private void DetermineAction(List<choices_WireColour> wireList, string? serialNumber)
    {
        _wireModule = new WireModule(wireList, serialNumber);
    }

    private void UpdateWireList(choices_WireColour wireColour)
    {
        selectedWires.Add(wireColour);

        DetermineAction(selectedWires, serialNumber);
    }

    private void ClearWireSelection()
    {
        selectedWires.Clear();

        DetermineAction(selectedWires, serialNumber);
    }

    private void OnSerialNumberKeyup(KeyboardEventArgs e)
    {
        DetermineAction(selectedWires, serialNumber);
    }
    
}